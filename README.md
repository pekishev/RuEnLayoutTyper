# RU→EN Layout Typer (CDP)

Chrome‑расширение, которое **эмулирует реальные нажатия клавиш** в активной вкладке через **Chrome DevTools Protocol (CDP)** и печатает текст так, как будто он набран в **английской раскладке по физическим клавишам** (ЙЦУКЕН→QWERTY).

Полезно, когда нужно “вбросить” текст **именно как набор клавиш**, а не вставку буфера, терминалы/консоли, поля с ограничениями на paste и т.п.

## Возможности

- **RU→EN перекодировка по физическим клавишам** (например `й→q`, `ф→a`, `ё→\``).
- **Автопереключение Alt+Shift** на границах “ASCII ↔ кириллица” исходного текста (как будто вы реально меняете раскладку).
- **Печать через CDP** (`Input.dispatchKeyEvent`) с поддержкой пунктуации и модификаторов.

## Установка (Load unpacked)

1) Откройте `chrome://extensions`.
2) Включите **Developer mode**.
3) Нажмите **Load unpacked** и выберите папку проекта.
4) Откройте нужную вкладку (куда печатать).
5) Нажмите на иконку расширения → вставьте текст → **“Напечатать (CDP)”**.
6) При первом запуске Chrome попросит разрешить “отладку вкладки” (permission `debugger`) — подтвердите.

## Как пользоваться

1) В поле попапа вставьте исходный текст (можно с переводами строк).
2) Нажмите **“Напечатать (CDP)”**.
3) Расширение:
   - вычислит позиции автопереключений Alt+Shift по **исходному** тексту,
   - перекодирует кириллицу в “английские” символы по физическим клавишам,
   - напечатает через CDP, отправляя Alt+Shift в нужных местах.

## Замечания и ограничения

- Расширение **не меняет раскладку ОС** “настоящим” способом — оно печатает последовательность событий так, чтобы на принимающей стороне получился нужный результат.
- Для работы требуется разрешение **`debugger`** (это ожидаемо для CDP‑ввода).
- Некоторые сайты/редакторы могут по‑разному реагировать на синтетические события; CDP обычно устойчивее, чем `KeyboardEvent`.

## Структура проекта

- `popup.html` / `popup.js` — UI попапа, отправка команды на печать.
- `mapping.js` — RU→EN маппинг и расчёт границ для Alt+Shift.
- `background.js` — service worker, CDP attach/detach и отправка `Input.dispatchKeyEvent`.
- `manifest.json` — MV3 манифест.

## Разработка

Быстрый цикл:

1) Откройте `chrome://extensions`.
2) Включите Developer mode.
3) После правок нажимайте **Reload** у расширения.
4) Откройте DevTools страницы service worker (кнопка **service worker** рядом с расширением), чтобы видеть логи/ошибки.

## Безопасность

Разрешение `debugger` даёт расширению возможность отправлять CDP‑команды в отлаживаемую вкладку. Устанавливайте и используйте расширение **только из доверенного исходника**.

## Лицензия

MIT — см. файл `LICENSE`.

