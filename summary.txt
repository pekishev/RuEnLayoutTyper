Вот краткий summary для нового чата (чтобы “очистить контекст”):

Цель: утилита, которая эмулирует набор клавиш в браузере, перекодируя русский текст в английскую раскладку по физическим клавишам (JCUKEN→QWERTY), с логикой «после ASCII идёт русский — как будто Alt+Shift, затем снова Alt+Shift при возврате к ASCII».

Эволюция решений:

Простое вставление текста → отклонено (нужны именно нажатия).

Псевдонабор через KeyboardEvent → нестабильно между версиями Chrome; добавили корректные key/code, поддержку Enter.

Финальное решение: Chrome-расширение на CDP (Chrome DevTools Protocol) с разрешением debugger, отправляет доверенные события через Input.dispatchKeyEvent. Это работает стабильнее на разных версиях Chrome.

Что делает финальное расширение:

Перекодирует RU→EN по клавишам (й→q, ф→a, ё→`, и т. п.).

Автоматически расставляет Alt+Shift-переключения на границах «ASCII ↔ кириллица» исходного текста.

Эмулирует реальные нажатия (включая Enter на переносах строк) через CDP.

Как пользоваться:

Установить как “Load unpacked” (MV3), расширение с разрешением debugger.

В попап вставить исходный текст → нажать «Напечатать (CDP)».

При первом запуске согласиться на «разрешить отладку вкладки».

Ограничения/заметки:

Расширение не меняет раскладку ОС — оно перекодирует символы и печатает их напрямую.

При необходимости можно добавить Tab/Backspace/Delete, настройку скорости (cps), таргетинг в конкретный iframe/shadow-root.

Этого краткого описания хватит, чтобы в новом чате быстро восстановить контекст и продолжить работу над расширением или доработками.